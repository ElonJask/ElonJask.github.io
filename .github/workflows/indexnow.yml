name: indexnow-submit

on:
  push:
    branches:
      - main
    paths:
      - "_posts/**"
      - "_posts_en/**"
      - "_config.yml"
      - "tags.md"
      - "en/tags.md"
  workflow_dispatch:
  schedule:
    - cron: "20 3 * * *"

jobs:
  submit:
    runs-on: ubuntu-latest
    env:
      INDEXNOW_KEY: ${{ secrets.INDEXNOW_KEY }}
    steps:
      - name: Skip when secret is missing
        if: ${{ env.INDEXNOW_KEY == '' }}
        run: echo "INDEXNOW_KEY is empty, skip submit."

      - name: Submit sitemap URLs to IndexNow
        if: ${{ env.INDEXNOW_KEY != '' }}
        uses: bojieyang/indexnow-action@v2
        with:
          sitemap-location: https://www.7fl.org/sitemap.xml
          key: ${{ env.INDEXNOW_KEY }}
          key-location: https://www.7fl.org/${{ env.INDEXNOW_KEY }}.txt
          endpoint: api.indexnow.org
          limit: 100
          failure-strategy: error
