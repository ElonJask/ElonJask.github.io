{% assign homeActive = 'active' %}
{% if page.hideHomeActive %}
{% assign homeActive = nil %}
{% endif %}
{% assign is_en_nav = false %}
{% if page.collection == 'posts_en' or page.lang == 'en-US' or page.lang == 'en' or page.url contains '/en/' %}
{% assign is_en_nav = true %}
{% endif %}
{% assign nav_menu = site.menu_zh %}
{% if is_en_nav %}
{% assign nav_menu = site.menu_en %}
{% endif %}
{% unless nav_menu and nav_menu.size > 0 %}
{% assign nav_menu = site.menu %}
{% endunless %}
<div class="header-menu" id="J_header">
  <ul class="header-item-container">
    <li class="header-item-title {{homeActive}}">
      {% if is_en_nav %}
      <a href="{{ '/en' | relative_url }}" class="title">{{ site.title }}</a>
      {% else %}
      <a href="{{ '/' | relative_url }}" class="title">{{ site.title }}</a>
      {% endif %}
    </li>

    {% for menu in nav_menu %}
    {% assign class = nil %}
    {% if (page.url contains menu.url and menu.url != '/') %}
    {% assign class = 'active' %}
    {% endif %}

    {% if menu.url contains 'http://' or menu.url contains 'https://' %}
    <li class="header-item-left {{class}}"><a href="{{menu.url}}" target="_blank" rel="noopener noreferrer">{{ menu.title }}</a></li>
    {% else %}
    {% assign menu_href = menu.url %}
    {% if is_en_nav %}
      {% unless menu_href contains '/en/' %}
      {% assign menu_href = '/en' | append: menu_href %}
      {% endunless %}
    {% endif %}
    <li class="header-item-left {{class}}"><a href="{{ menu_href | relative_url }}">{{ menu.title }}</a></li>
    {% endif %}
    {% endfor %}

    <li class="header-item search-btn-container">
      <button id="search-btn" class="search-btn" aria-label="{% if is_en_nav %}Search{% else %}搜索{% endif %}" title="{% if is_en_nav %}Search (Press /){% else %}搜索（按 /）{% endif %}">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <circle cx="11" cy="11" r="7" stroke="currentColor" stroke-width="2" />
          <path d="M20 20L16 16" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
        </svg>
      </button>
    </li>

    {% include flags.html %}

  </ul>
</div>

{% assign fontSize = 36 %}
{% if page.url contains '/en/' %}
{% assign fontSize = 34 %}
{% endif %}
{% assign header_title = page.hero_title | default: page.title %}
<div class="entry-header">
  <svg width="100%" height="200" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
    version="1.1" role="img" aria-label="{{ header_title }}">
    <path id="svg-title-path">
      <animate attributeName="d" from="m0,110 h0" to="m0,110 h1600" dur="2s" repeatCount="1" fill="freeze" begin="0s" />
    </path>
    <text font-size="{{fontSize}}" font-weight="600" fill="#ffffff" x="50%" y="50%" text-anchor="middle"
      word-spacing="2.0" letter-spacing="1.2">
      <textPath xlink:href="#svg-title-path">{{ header_title }}</textPath>
    </text>
  </svg>
  <canvas id="J_firework_canvas" aria-hidden="true" role="presentation"></canvas>
</div>
