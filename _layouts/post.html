<!DOCTYPE html>
<html lang="{{ page.lang | default: site.lang }}">
<head>
  {% include site-head.html %}
  <link rel="stylesheet" media="screen and (min-width: 600px)" href="{{ '/styles/post.css' | relative_url }}">
  <link rel="stylesheet" media="screen and (max-width: 600px)" href="{{ '/styles/post_mobile.css' | relative_url }}">
  <link rel="stylesheet" media="screen and (min-width: 600px)" href="{{ '/styles/navigatebar.css' | relative_url }}">
  <link rel="stylesheet" media="screen and (max-width: 600px)" href="{{ '/styles/navigatebar_mobile.css' | relative_url }}">
  {% if content contains '<pre' or content contains 'highlighter-rouge' or content contains 'language-' %}
  <link rel="stylesheet" href="{{ '/theme/highlight.css' | relative_url }}">
  {% endif %}
</head>
<body>
  {% include target-nav.html %}

  {% assign is_en_post = false %}
  {% if page.collection == 'posts_en' or page.lang == 'en-US' or page.lang == 'en' or page.url contains '/en/' %}
    {% assign is_en_post = true %}
  {% endif %}
  {% assign topic_defs = site.topics_zh %}
  {% assign topic_base = '/topics' %}
  {% if is_en_post %}
    {% assign topic_defs = site.topics_en %}
    {% assign topic_base = '/en/topics' %}
  {% endif %}
  {% assign topic_name = page.topic %}
  {% if page.topic and topic_defs and topic_defs.size > 0 %}
    {% for topic in topic_defs %}
      {% if topic.key == page.topic %}
        {% assign topic_name = topic.name %}
        {% break %}
      {% endif %}
    {% endfor %}
  {% endif %}

  {% assign plain = content | strip_html | replace: "\r", " " | replace: "\n", " " | replace: "  ", " " %}
  {% assign char_count = plain | replace: " ", "" | split: "" | size %}
  {% assign word_count = plain | split: " " | size %}

  <main class="content-area" role="main">
    <div class="title">{{ page.title }}</div>
    <div class="post-meta">
      <div class="category-area">
        {% if page.topic and topic_name and topic_name != '' %}
        <a href="{{ topic_base | relative_url }}#topic-{{ page.topic }}"><div class="category">{{ topic_name }}</div></a>
        {% endif %}
        {% if page.tags and page.tags.size > 0 %}
          {% for tag in page.tags limit: 4 %}
          <div class="category">{{ tag }}</div>
          {% endfor %}
        {% endif %}
      </div>
      <div class="char-counter">
        {{ page.date | date: "%Y-%m-%d" }}
        {% if is_en_post %}
          {{ word_count }} words
        {% else %}
          {{ char_count }}å­—
        {% endif %}
      </div>
    </div>
    <div class="content">
      {{ content | cdn_image_filter }}
    </div>

    {% include giscus.html %}
  </main>
  {% include footer.html %}
</body>
</html>
